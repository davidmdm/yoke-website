<h1>
  YokeCD
  <span style="font-size: 0.5em; color: white">alpha</span>
</h1>

<section class="container">
  <h2>GitOps: Yoke & ArgoCD</h2>
  <p>
    The Yoke CLI is analogous to Helm's. It is a client-side tool that communicates with your cluster and keeps track of
    packages deployed to it. However, for many, that is not how we deploy packages anymore, Helm or not. Where the words
    <em>Platform Engineering</em> are uttered, <em>GitOps</em> is sure to follow.
  </p>
  <p>
    To that end, we want to be able to declare our Flights as static resources that a controller such as ArgoCD will
    pick up and then manage our resources for us. Out of the box, ArgoCD supports Helm, Jsonnet, and Kustomize. To
    support more use cases, it accepts extensions to K8s manifest generation via
    <a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/config-management-plugins"
      >config management plugins</a
    >.
  </p>
</section>

<section class="container">
  <h2>Introducing YokeCD</h2>
  <p>
    To be compatible with ArgoCD, Yoke offers an ArgoCD CPM Sidecar Docker image hosted at
    <a href="https://hub.docker.com/repository/docker/davidmdm/yokecd/general">DockerHub - davidmdm/yokecd</a>.
  </p>
</section>

<section class="container">
  <h2>Installing YokeCD Sidecar</h2>
  <h3>Fresh ArgoCD Installation</h3>
  <p>
    The yoke project maintains a Flight that wraps the
    <a href="https://github.com/argoproj/argo-helm/releases/tag/argo-cd-6.7.12"> ArgoCD Chart v6.17.2</a>. Any input
    passed to the flight via stdin is directly passed to the ArgoCD Chart. Additionally the Flight installs the sidecar
    on the argocd-repo-server making the yokecd plugin available to argocd applications.
  </p>
  <pre><code class="language-bash">yoke takeoff --namespace argocd yokecd https://github.com/davidmdm/yoke/releases/download/yokecd-installer%2Fv0.0.2/yokecd-installer.wasm.gz</code></pre>
  <h3>Patch an Existing ArgoCD Installation</h3>
  <p>Docs under construction.</p>
</section>

<section class="container">
  <h2>Creating YokeCD Applications</h2>
  <p>YokeCD applications are normal ArgoCD Applications that use the yokecd plugin.</p>
  <pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: example
  namespace: argocd
spec:
  project: default
  source:
    plugin:
      name: yokecd
# ... and all other required fields</code></pre>

  <h3>Parameters</h3>
  <p>
    In order to use and configure the plugin, we must pass parameters to it. The following parameters are supported:
  </p>

  <div class="table">
    <div><strong>Parameter</strong></div>
    <div><strong>Type</strong></div>
    <div><strong>Description</strong></div>

    <div>wasm</div>
    <div>string</div>
    <div>
      The url to download or the relative location in the source repository to the Flight's wasm asset. Cannot be used
      when parameter <strong>build</strong> is enabled.
    </div>

    <div>build</div>
    <div>string</div>
    <div>
      A boolean string signalling that the wasm should be compiled on the fly by yokecd using the Go Toolchain in the
      context of the Application's source. Cannot be used with parameter <strong>wasm</strong>
    </div>

    <div>input</div>
    <div>string</div>
    <div>The input that will be passed as stdin to the wasm executable upon execution</div>

    <div>args</div>
    <div>[]string</div>
    <div>The args that will be passed to the Flight Executable upon execution</div>
  </div>

  <p><strong>One of build or wasm must be specified.</strong></p>

  <pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: pg
  namespace: argocd
spec:
  project: default

  source:
    repoURL: https://github.com/davidmdm/yokecd-demo
    path: ./cmd/pg
    targetRevision: main

    plugin:
      name: yokecd
      parameters:
        # Will use the asset found at https://github.com/davidmdm/yokecd-demo/cmd/pg/main.wasm.gz
        # at revision main.
        #
        # This parameter cannot be used at the same time as "build"
        - name: wasm
          string: main.wasm.gz # Alternatively can be a url for example:
                               # https://github.com/org/repo/releases/downloads/v1.0.0/main.wasm
                               # If this is the case the application's source is not used.

        # Will build the wasm executable using the Go Toolchain with the source specified by the application.
        # The source must be a Go Module or inside a Go module.
        #
        # This parameter cannot be used at the same time as "wasm"
        - name: build
          string: 'true'

        - name: args
          array: ["--key=value", "positional-arg"]

        - name: input
          string: 'any-input-you-want'

  destination:
    name: in-cluster
    namespace: default

  syncPolicy:
    automated:
      prune: true
      selfHeal: true</code></pre>
</section>
